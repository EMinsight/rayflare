---
title: 'RayFlare: flexible optical modelling of soalr cells across length scales'
tags:
  - Python
  - physics
  - optics
  - solar cells
  - ray-tracing
  - rigorous coupled-wave analysis
  - transfer matrix method
  - multi-scale modelling
  
authors:
  - name: Phoebe M. Pearce
    orcid: 0000-0001-9082-9506
    affiliation: 1
affiliations:
 - name: Department of Physics, University of Cambridge, 19 JJ Thomson Avenue, Cambridge CB3 0HE
   index: 1

date: 24 May 2021
bibliography: paper.bib

---

# Summary

A summary describing the high-level functionality and purpose of the software for a diverse, non-specialist audience.

Optical modelling is a key part of the design of solar cells, as the number of absorbed photons in the photovoltaic
layer(s) fundamentally limits the current which can be generated by the cell. Some types of cell design, such as 
multi-junction cells (where multiple semiconductors with different bandgaps are stacked in a single structure to 
each absorb a different part of the solar spectrum) or ultra-thin solar cells [reference?], require even more careful optical design.
In the first case, it is generally desirable to match the current generated in each layer, requiring tuning of e.g. the
bandgaps and layer thicknesses, while in the second case light-trapping structures such as gratings or surface textures
are required to maintain high absorption and thus current while reducing the semiconductor thickness.

Light-trapping structures range from the relatively simple (e.g. dielectric layers used as anti-reflection coatings
on the front surface of all commercial solar cells) to highly engineered structures for very specific purposes (e.g.
diffraction gratings for ultra-thin GaAs solar cells for space applications). As such, many different simulation methods 
exist which are appropriate for modelling the effect of different light-trapping structures. These include:

- **Simple Beer-Lambert law calculations**: assumes the intensity of light in the material varies as
  $I(z) = I_0 e^{-\alpha z}$, where $z$ is the depth in the material and $\alpha$ is the absorption coefficient. This 
  neglects any effects due to reflection at interfaces, interference, diffraction etc.
- **Ideal/theoretical reference cases**: such as a perfect mirror or perfect Lambertian scatterer. Often used for comparison
  purposes to benchmark the performance of realistic structures.
- **Ray-tracing (RT)**: Geometric optics. Suitable for calculating reflection and refraction due to large-scale 
  (compared to the wavelength) textures, such as the pyramidal texturing commonly using for silicon solar cells
- **Transfer-matrix method (TMM)**: Suitable for calculating interference effects in thin-films (transparent or absorbing).
  This is useful for e.g. calculating the effect of an anti-reflection coating on the front surface of a cell, or
  a distributed Bragg reflector (DBR) to reflect specific wavelengths of lights.
- **Full Maxwell solvers**: including rigorous coupled-wave analysis (RCWA), also referred to as the Fourier modal method (FMM),
  finite element modelling (FEM) or finite-difference time-domain (FDTD) methods. Since these are more general solutions for
  solving Maxwell's equations in (periodically) textured layers, these have many uses, but are often used in solar cell
  optics research to calculate the effect of gratings or arrays of nanoparticles on absorption in the cell.

Existing packages already implement one or more of these methods. For instance, .... Byrnes (TMM), ray-tracers, S4,
large commercial softwares

The aim of RayFlare is to provide a single integrated environment with a consistent approach to defining structures which
incorporates all the methods listed above (currently using RCWA as the Maxwell solver). 


The idea behind RayFlare is to provide a comprehensive and flexible optical modelling framework. At the moment,
the following methods are included:

All of these methods can be used to simulate a whole structure (using the rt_structure, tmm_structure and rcwa_structure
classes, respectively). In this case, the relevant materials and thicknesses of the layers, surface textures (RT) or grating shapes
(RCWA) are defined by the user and the reflection, transmission, absorption per layer and (if specified) absorption profile
in the structure are calculated by RayFlare.

However, they can also be used in combination with each other by using the matrix formalism. In this
framework, the front and rear surface of the structure are decoupled from one another, and suitable methods are used for each surface
to calculate so-called redistribution matrices. These matrices described how light striking the surface from different directions
is scattered into other directions (which can be in transmission or reflection) or absorbed by any surface layers. The front and
back surface are coupled by some bulk medium, in which simple Beer-Lambert absorption is assumed. This reduces the problem down
to a conceptually simple matrix multiplication process to calculate total reflection, transmission, and absorption in the
surface layers and bulk medium. Note that for the Beer-Lambert absorption approximation to be valid, the bulk medium must be thick
enough that interference effects in it can be neglected, i.e. significantly thicker than the maximum wavelength being considered.

While this matrix multiplication framework has been previously established by e.g. OPTOS and GenPro4, the novelty of RayFlare is that
it will automatically calculate the necessary redistribution matrices for the user-defined structure (using any of the methods listed below)
at the required wavelengths as well as performing the matrix multiplication, including tracking absorption in any surface layers on the
front and rear surface. It can also calculate absorption profiles in the surface and bulk layers, something which has not previously been
demonstrated.

The methods currently available to generate redistribution matrices are:

- **Ray-tracing with the Fresnel equations**. This is suitable for simple interfaces with some large-scale texture and no surface layers.
- **Integrated ray-tracing and transfer-matrix method**: The probability of reflection/transmission
  (or absorption in interface layers) are calculated using TMM rather than through the Fresnel equations. This is suitable for large-scale
  textures with one or more thin (compared to the size of the texture features) surface layers.
- **TMM**: Suitable for planar surfaces with multiple layers.
- **RCWA**: For gratings, which can be made of multiple layers including planar layers.

![Caption for example figure.](rayflare_diagram_crop.pdf){ width=100% }

# Statement of need

RayFlare provides one coherent environment implementing many of the most commonly-used optical modelling techniques 
for solar cells, al

RayFlare, or code which was integrated into RayFlare, were used to:

- emissivity @Alonso-Alvarez2019c
- ultra-thin cells @Pearce2020

# Citations

Similar:
- OPTOS @Eisenlohr2015 @Tucher2015
- GenPro4 @Santbergen2017
- CROWM
- Raytracers; PVLighthouse, OPAL?

@Pearce2020
@Alonso-Alvarez2018
@Byrnes2016
@Pearce2019a
@Liu2012
@Santbergen2017
@Eisenlohr2015
@Tucher2015
@Alonso-Alvarez2019c

# Figures

# Acknowledgements

- Diego
- Ned

# References
